<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.16.5/math.min.js"></script>
    <script>
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
    </script>
    <script type='text/javascript'>
        function pageLoad() {
           pageLoadMeanState();
        }
    </script>
    <script type='text/javascript'>

        function updateImagesAndHeadersMeanState(){
            var rsel  = document.getElementById("MeanStateRegion");
            var msel  = document.getElementById("MeanStateModel");
            var rid   = rsel.selectedIndex;
            var mid   = msel.selectedIndex;
            var RNAME = rsel.options[rid].value;
            var MNAME = msel.options[mid].value;
            var CNAME = "GlobalNetEcosystemCarbonBalance / Hoffman / 1850-2011";
            var head  = "CNAME / RNAME / MNAME";
            head      = head.replace("CNAME",CNAME).replace("RNAME",RNAME).replace("MNAME",MNAME);
            $("#MeanStateHead").text(head);
            
          document.getElementById('spaceint').src =  MNAME + '_' + RNAME + '_spaceint.png'
          document.getElementById('accumulate').src =  MNAME + '_' + RNAME + '_accumulate.png'
          document.getElementById('legend_compcycle').src =  'legend_compcycle.png'
          document.getElementById('compaccumulation').src =  RNAME + '_compaccumulation.png'
        }

        function highlightRowMeanState(cell) {
            var select = document.getElementById("MeanStateRegion");
            for (var i = 0; i < select.length; i++){
                var table = document.getElementById("MeanState_table_" + select.options[i].value);
                var rows  = table.getElementsByTagName("tr");
                for (var r = 2; r < rows.length; r++) {
                    for (var c = 0; c < rows[r].cells.length-4; c++) {
                        rows[r].cells[c].style.backgroundColor = "#ffffff";
                    }
                }
                var r = cell.closest("tr").rowIndex;
                document.getElementById("MeanStateModel").selectedIndex = r-1;
                for (var c = 0; c < rows[r].cells.length-4; c++) {
                    rows[r].cells[c].style.backgroundColor = "#c1c1c1";
                }
            }
            updateImagesAndHeadersMeanState();
        }

        function paintScoreCellsMeanState(RNAME) {

	    var PuOr = ['#b35806','#e08214','#fdb863','#fee0b6','#f7f7f7','#d8daeb','#b2abd2','#8073ac','#542788'];
	    var GnRd = ['#b2182b','#d6604d','#f4a582','#fddbc7','#f7f7f7','#d9f0d3','#a6dba0','#5aae61','#1b7837'];
	    var colors = GnRd;
            var nc = colors.length;
            var table  = document.getElementById("MeanState_table_" + RNAME);
            var rows   = table.getElementsByTagName("tr");
            for (var c = rows[0].cells.length-3; c < rows[0].cells.length; c++) {
                var scores = [];
                for (var r = 2; r < rows.length; r++) {
                    val = rows[r].cells[c].innerHTML;
                    if (val=="") {
                      scores[r-2] = 0;
                    }else{
                      scores[r-2] = parseFloat(val);
                    }
                }
                var mean = math.mean(scores);
                var std  = math.max(0.02,math.std(scores));
                for (var r = 2; r < rows.length; r++) {
                    scores[r-2] = Math.min(+2,Math.max(-2,(scores[r-2]-mean)/std));
                }
                for (var r = 2; r < rows.length; r++) {
		    var e  = scores[r-2];
                    var ae = Math.abs(e);
                    var clr;
                    if(ae >= 0.25){
                      clr = math.round(2*e+4);
                    }else{
		      clr = math.round(4*e+4);
                    }
                    clr = math.min(math.max(0,clr),8);
                    rows[r].cells[c].style.backgroundColor = colors[clr];
                }
            }
        }

        function pageLoadMeanState() {
            var select = document.getElementById("MeanStateRegion");
            var region = getQueryVariable("region");
            var model  = getQueryVariable("model");
            if (region) {
                for (var i = 0; i < select.length; i++){
                    if (select.options[i].value == region) select.selectedIndex = i;
                }
            }
            var table = document.getElementById("MeanState_table_" + select.options[select.selectedIndex].value);
            var rows  = table.getElementsByTagName("tr");
            if (model) {
                for (var r = 0; r < rows.length; r++) {
                    if(rows[r].cells[0].innerHTML==model) highlightRowMeanState(rows[r].cells[0]);
                }
            }else{
                highlightRowMeanState(rows[2]);
            }
            for (var i = 0; i < select.length; i++){
                paintScoreCellsMeanState(select.options[i].value);
            }
            changeRegionMeanState();
        }

        function changeRegionMeanState() {
            var select = document.getElementById("MeanStateRegion");
            for (var i = 0; i < select.length; i++){
                RNAME = select.options[i].value;
                if (i == select.selectedIndex) {
                    document.getElementById("MeanState_table_" + RNAME).style.display = "table";
                }else{
                    document.getElementById("MeanState_table_" + RNAME).style.display = "none";
                }
            }
            updateImagesAndHeadersMeanState();
        }
      function AllSelect() {
        var header = "CNAME / RNAME / MNAME";
        var CNAME  = "GlobalNetEcosystemCarbonBalance / Hoffman / 1850-2011";
        header     = header.replace("CNAME",CNAME);
        var rid    = document.getElementById("AllModelsRegion").selectedIndex;
        var RNAME  = document.getElementById("AllModelsRegion").options[rid].value;
        var pid    = document.getElementById("AllModelsPlot").selectedIndex;
        var PNAME  = document.getElementById("AllModelsPlot").options[pid].value;
        header     = header.replace("RNAME",RNAME);
        $("#AllModelsHead").text(header);
        if(PNAME == "spaceint" || PNAME == "accumulate" || PNAME == "compaccumulation"){
          document.getElementById("Benchmark_div").style.display = 'none';
        }else{
          document.getElementById("Benchmark_div").style.display = 'inline';
        }
        if(PNAME == "spaceint" || PNAME == "accumulate" || PNAME == "compaccumulation"){
          document.getElementById("Benchmark_legend").style.display = 'none';
          document.getElementById("E3SM_legend").style.display = 'none';
          document.getElementById("E3SM-FUN2.0_legend").style.display = 'none';
          document.getElementById("E3SM-FUN3.0_legend").style.display = 'none';
        }else{
          document.getElementById("Benchmark_legend").style.display = 'inline';
          document.getElementById("E3SM_legend").style.display = 'inline';
          document.getElementById("E3SM-FUN2.0_legend").style.display = 'inline';
          document.getElementById("E3SM-FUN3.0_legend").style.display = 'inline';
        }
        document.getElementById('Benchmark').src = 'Benchmark_' + RNAME + '_' + PNAME + '.png';
        document.getElementById('Benchmark_legend').src = 'legend_' + PNAME + '.png';
        document.getElementById('E3SM').src = 'E3SM_' + RNAME + '_' + PNAME + '.png';
        document.getElementById('E3SM_legend').src = 'legend_' + PNAME + '.png';
        document.getElementById('E3SM-FUN2.0').src = 'E3SM-FUN2.0_' + RNAME + '_' + PNAME + '.png';
        document.getElementById('E3SM-FUN2.0_legend').src = 'legend_' + PNAME + '.png';
        document.getElementById('E3SM-FUN3.0').src = 'E3SM-FUN3.0_' + RNAME + '_' + PNAME + '.png';
        document.getElementById('E3SM-FUN3.0_legend').src = 'legend_' + PNAME + '.png';
      }

      $(document).on('pageshow', '[data-role="page"]', function(){
        AllSelect()
      });
    </script>
    <style type="text/css">
      .container{
        display:inline;
      }
      .break{
        clear:left;
      }
      .child{
        margin-bottom:10px;
        display:inline-block;
        padding:5px;
        font-size: 20px;
        font-weight: bold;
      }
      table.table-header-rotated {
          border-collapse: collapse;
      }
      td {
          text-align: center;
          padding: 10px 5px;
          border: 1px solid #ccc;
      }
      th {
          padding: 5px 10px;
      }
      th.rotate {
          height: 280px;
          white-space: nowrap;
      }
      th.rotate > div {
          transform: translate(10px, 135px) rotate(-45deg);
          width: 0px;
      }
      th.rotate > div > span {
      }
      th.row-header {
          padding: 0px 10px;
          text-align: right;
      }
      td.divider {
          width: 0px;
          border: 0px solid #ccc;
          padding: 0px 0px
      }
    </style>
  </head>
  <body onload="pageLoad()">
    <div data-role="page" id="MeanState">
      <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1 id="MeanStateHead">Mean State</h1>
        <div data-role="navbar">
          <ul>
            <li><a href='#MeanState' class=ui-btn-active ui-state-persist>Mean State</a></li>
            <li><a href='#AllModels'>All Models</a></li>
            <li><a href='#DataInformation'>Data Information</a></li>
          </ul>
        </div>
      </div>
      <select id="MeanStateRegion" onchange="changeRegionMeanState()">
        <option value='global' selected="selected">Global - Land</option>
      </select>
      <div style="display:none">
      <select id="MeanStateModel">
        <option value='Benchmark'>Benchmark</option>
        <option value='E3SM' selected="selected">E3SM</option>
        <option value='E3SM-FUN2.0'>E3SM-FUN2.0</option>
        <option value='E3SM-FUN3.0'>E3SM-FUN3.0</option>
      </select>
      </div>
        <center>
        <table class="table-header-rotated" id="MeanState_table_global">
           <thead>
             <tr>
               <th></th>
               <th class="rotate"><div><span>Download Data</span></div></th>
               <th class="rotate"><div><span>nbp(2011) [Pg]</span></div></th>
               <th class="rotate"><div><span>diff(2011) [Pg]</span></div></th>
               <th></th>
               <th class="rotate"><div><span>Difference Score [1]</span></div></th>
               <th class="rotate"><div><span>Trajectory Score [1]</span></div></th>
               <th class="rotate"><div><span>Overall Score [1]</span></div></th>
             </tr>
           </thead>
           <tbody>
             <tr>
               <td class="row-header">Benchmark</td>
               <td><a href="Hoffman_Benchmark.nc" download>[-]</a></td>
               <td>8.04</td>
               <td></td>
               <td class="divider"></td>
               <td></td>
               <td></td>
               <td></td>
             </tr>
             <tr>
               <td onclick="highlightRowMeanState(this)" class="row-header">E3SM</td>
               <td onclick="highlightRowMeanState(this)"><a href="Hoffman_E3SM.nc" download>[-]</a></td>
               <td onclick="highlightRowMeanState(this)">28.9</td>
               <td onclick="highlightRowMeanState(this)">20.9</td>
               <td onclick="highlightRowMeanState(this)" class="divider"></td>
               <td onclick="highlightRowMeanState(this)">0.868</td>
               <td onclick="highlightRowMeanState(this)">0.469</td>
               <td onclick="highlightRowMeanState(this)">0.669</td>
             </tr>
             <tr>
               <td onclick="highlightRowMeanState(this)" class="row-header">E3SM-FUN2.0</td>
               <td onclick="highlightRowMeanState(this)"><a href="Hoffman_E3SM-FUN2.0.nc" download>[-]</a></td>
               <td onclick="highlightRowMeanState(this)">19.2</td>
               <td onclick="highlightRowMeanState(this)">11.2</td>
               <td onclick="highlightRowMeanState(this)" class="divider"></td>
               <td onclick="highlightRowMeanState(this)">0.927</td>
               <td onclick="highlightRowMeanState(this)">0.397</td>
               <td onclick="highlightRowMeanState(this)">0.662</td>
             </tr>
             <tr>
               <td onclick="highlightRowMeanState(this)" class="row-header">E3SM-FUN3.0</td>
               <td onclick="highlightRowMeanState(this)"><a href="Hoffman_E3SM-FUN3.0.nc" download>[-]</a></td>
               <td onclick="highlightRowMeanState(this)">18.0</td>
               <td onclick="highlightRowMeanState(this)">9.92</td>
               <td onclick="highlightRowMeanState(this)" class="divider"></td>
               <td onclick="highlightRowMeanState(this)">0.935</td>
               <td onclick="highlightRowMeanState(this)">0.386</td>
               <td onclick="highlightRowMeanState(this)">0.660</td>
             </tr>
          </tbody>
        </table>
        </center>
        <div data-role="collapsible" data-collapsed="false"><h1>Spatially integrated regional mean</h1>
        <div class="container" id="legend_compcycle_div">
          <div class="child">
          <center>MODEL&nbsp;COLORS</center>
          <img src="" id="legend_compcycle" alt="Data not available" ></img>
          </div>
        </div>
        <div class="container" id="compaccumulation_div">
          <div class="child">
          <center>ACCUMULATION</center>
          <img src="" id="compaccumulation" alt="Data not available" ></img>
          </div>
        </div>
        <div class="container" id="spaceint_div">
          <div class="child">
          <center>REGIONAL&nbsp;MEAN</center>
          <img src="" id="spaceint" alt="Data not available" ></img>
          </div>
        </div>
        <div class="container" id="accumulate_div">
          <div class="child">
          <center>ACCUMULATION</center>
          <img src="" id="accumulate" alt="Data not available" ></img>
          </div>
        </div>
        </div>
    </div>
    <div data-role="page" id="AllModels">
      <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1 id="AllModelsHead">All Models</h1>
        <div data-role="navbar">
          <ul>
            <li><a href='#MeanState'>Mean State</a></li>
            <li><a href='#AllModels' class=ui-btn-active ui-state-persist>All Models</a></li>
            <li><a href='#DataInformation'>Data Information</a></li>
          </ul>
        </div>
      </div>
      <select id="AllModelsRegion" onchange="AllSelect()">
        <option value='global' selected="selected">Global - Land</option>
      </select>
      <select id="AllModelsPlot" onchange="AllSelect()">
        <option value='spaceint'>Spatially integrated regional mean</option>
        <option value='accumulate'>Accumulated mean</option>
      </select>
        <div class="container" id="Benchmark_div">
          <div class="child">
          <center>Benchmark</center>
          <img src="" id="Benchmark" alt="Data not available" ></img>
          <center><img src="legend_Benchmark.png" id="Benchmark_legend"  alt="Data not available" ></img></center>
          </div>
        </div>
        <div class="container" id="E3SM_div">
          <div class="child">
          <center>E3SM</center>
          <img src="" id="E3SM" alt="Data not available" ></img>
          <center><img src="legend_E3SM.png" id="E3SM_legend"  alt="Data not available" ></img></center>
          </div>
        </div>
        <div class="container" id="E3SM-FUN2.0_div">
          <div class="child">
          <center>E3SM-FUN2.0</center>
          <img src="" id="E3SM-FUN2.0" alt="Data not available" ></img>
          <center><img src="legend_E3SM-FUN2.0.png" id="E3SM-FUN2.0_legend"  alt="Data not available" ></img></center>
          </div>
        </div>
        <div class="container" id="E3SM-FUN3.0_div">
          <div class="child">
          <center>E3SM-FUN3.0</center>
          <img src="" id="E3SM-FUN3.0" alt="Data not available" ></img>
          <center><img src="legend_E3SM-FUN3.0.png" id="E3SM-FUN3.0_legend"  alt="Data not available" ></img></center>
          </div>
        </div>
    </div>
    <div data-role="page" id="DataInformation">
      <div data-role="header" data-position="fixed" data-tap-toggle="false">
        <h1 id="DataInformationHead">Data Information</h1>
        <div data-role="navbar">
          <ul>
            <li><a href='#MeanState'>Mean State</a></li>
            <li><a href='#AllModels'>All Models</a></li>
            <li><a href='#DataInformation' class=ui-btn-active ui-state-persist>Data Information</a></li>
          </ul>
        </div>
      </div>
      
<p><dl><dt><b>&nbsp;&nbsp;Title:</dt></b><dd>Land and ocean anthropogenic carbon flux estimates</dd></dl></p><p><dl><dt><b>&nbsp;&nbsp;Institution:</dt></b><dd>University of California at Irvine and Oak Ridge National Laboratory</dd></dl></p><p><dl><dt><b>&nbsp;&nbsp;History:</dt></b><dd>Created by Forrest M. Hoffman <forrest@climatemodeling.org> on Fri May 13 14:56:48 2016</dd></dl></p><p><dl><dt><b>&nbsp;&nbsp;References:</dt></b><dd>Hoffman, Forrest M., James T. Randerson, Vivek K. Arora, Qing Bao, Patricia Cadule, Duoying Ji, Chris D. Jones, Michio Kawamiya, Samar Khatiwala, Keith Lindsay, Atsushi Obata, Elena Shevliakova, Katharina D. Six, Jerry F. Tjiputra, Evgeny M. Volodin, and Tongwen Wu, (2014) Causes and Implications of Persistent Atmospheric Carbon Dioxide Biases in Earth System Models. J. Geophys. Res. Biogeosci., 119(2):141–162. <a href='https://doi.org/10.1002/2013JG002381'>doi:10.1002/2013JG002381</a>.</dd></dl></p><p><dl><dt><b>&nbsp;&nbsp;Contact:</dt></b><dd>forrest@climatemodeling.org</dd></dl></p>
    </div>
  </body>
</html>